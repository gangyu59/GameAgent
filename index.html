<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>二人围棋</title>

  <!-- 依赖库 -->
  <script src="https://cdn.jsdelivr.net/npm/peerjs@1.4.7/dist/peerjs.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <h2 class="center">二人围棋</h2>

  <!-- 房主视图 -->
  <div id="hostView" class="center" style="display:none;">
    <button class="btn" onclick="UI.createRoomAndShowId()">创建房间</button>
    <div id="roomInfo" class="info"></div>
  </div>

  <!-- 访客视图 -->
  <div id="guestView" class="center" style="display:none;">
    <input id="roomIdInput" placeholder="输入房间ID" />
    <button class="btn" onclick="UI.joinRoomFromInput()">加入房间</button>
    <div id="roomInfo" class="info"></div>
  </div>

  <div id="board"></div>

  <div id="debug-panel">
    <h3>调试信息</h3>
    <div id="debug-log"></div>
  </div>

  <!-- 控制台 -->
  <div id="mobile-console-toggle" onclick="toggleConsole()">调试台</div>
  <div id="mobile-console" style="display:none;">
    <button onclick="document.getElementById('mobile-console').style.display='none'">关闭</button>
    <div id="console-log"></div>
  </div>

  <!-- JS 加载 -->
  <script src="js/firebase-init.js"></script>
  <script src="js/webrtc-conn.js"></script>
  <script src="js/game-logic.js"></script>
  <script src="js/ui-render.js"></script>
  <script src="js/utils.js"></script>

  <script>
    const originalConsole = {...console};
    window.console = {
      log: (...args) => {
        originalConsole.log(...args);
        document.getElementById('console-log').innerHTML += `<div style="color:#0f0">${args.join(' ')}</div>`;
      },
      error: (...args) => {
        originalConsole.error(...args);
        document.getElementById('console-log').innerHTML += `<div style="color:#f00">${args.join(' ')}</div>`;
      }
    };
    function toggleConsole() {
      const panel = document.getElementById("mobile-console");
      panel.style.display = panel.style.display === "none" ? "block" : "none";
    }

    function getQueryParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    window.game = {
      players: [],
      currentPlayer: 'black',
      boardSize: 9
    };

    document.addEventListener('DOMContentLoaded', () => {
      renderBoard();
      const room = getQueryParam("room");

      if (room) {
        document.getElementById('guestView').style.display = 'block';
        document.getElementById('roomIdInput').value = room;
      } else {
        document.getElementById('hostView').style.display = 'block';
      }

      console.log("系统启动完成");
    });
  </script>
</body>
</html>